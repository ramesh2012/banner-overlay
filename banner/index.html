<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>NRNA CHIBA FESTIVAL 2024</title>

    <!-- Bootstrap CSS -->
    <link href="css/style.css" rel="stylesheet" />

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@100..900&display=swap" rel="stylesheet">

    <link rel="icon" type="image/x-icon" href="img/favicon.ico">

</head>
<script type="text/javascript" src="js/caman.full.js"></script>

<body>
    <main>
        <header>
            <div class="logo">
                <img src="logo.png" class="" />
               
            </div>
        </header>


        <h1>NRNA CHIBA FESTIVAL 2024</h1>
        <div class="description">
        यो NRNA चिबा को फेस्टिवल को डिजाइन बनाउने टुल हो। तपाईंले आफ्नो मनपर्ने फोटो राखेर चिबा फेस्टिवलको ब्यानर बनाउन
        सक्नुहुन्छ र फेस्टिवललाई सफल बनाउनको लागि अनुरोध गर्दछौं।
        </div>
        <div class="upload-img">
			
            <input type="file" accept="image/*" onchange="loadFile(event)" id="file" class="inputfile" />
            <label for="file">Choose Profile Image</label>
        </div>

        <div class="center photo-frame">
			<div id="spinner" class="spinner-border" role="status" style="display: none;">
			</div>
			<img id="overlay-img" src="plain.png" />
            
        </div>
        </div>

    

        <div class="center">

            <button id="downloadBtn" class="btn blue-btn"  style="display: none; " onclick="downloadImage()">Download Image</button>
        </div>

		<div class="madeBy">Made by <a href="#" target="_blank">RAMESH GIRI</a> using <a href="#" target="_blank">CamanJS</a></div>
    </main>

</body>
<script>
	function checkSNSBrowser() {
		var userAgent = navigator.userAgent || navigator.vendor || window.opera;

		// List of SNS user agents to check
		var snsBrowsers = [
			/FBAV/i,  // Facebook in-app browser
			/Instagram/i,  // Instagram in-app browser
			/Twitter/i,  // Twitter in-app browser
			/Line/i,  // Line in-app browser
			/Snapchat/i,  // Snapchat in-app browser
		];

		// Check if userAgent matches any of the SNS browsers
		var isSNSBrowser = snsBrowsers.some(function(browser) {
			return userAgent.match(browser);
		});

		if (isSNSBrowser) {
			alert("This feature is not supported in the current browser.");
		}
	}
	function isPc() {
		const userAgent = navigator.userAgent;
		const mobileKeywords = [
			'Android', 'webOS', 'iPhone', 'iPad', 'iPod', 'BlackBerry',
			'Windows Phone', 'Opera Mini', 'IEMobile', 'Mobile'
		];

		// Check for common mobile keywords
		for (let keyword of mobileKeywords) {
			if (userAgent.includes(keyword)) {
			return false; // Found a mobile keyword, hence not a PC
			}
		}

		return true; // No mobile keywords found, hence it's a PC
	}


	document.getElementById('overlay-img').addEventListener('click', function() {
		document.getElementById('file').click();
	});	
	
	function sleep(ms) {
		return new Promise(resolve => setTimeout(resolve, ms));
	}

var loadFile = function(event) {
	var reader = new FileReader();
	reader.onload = function() {
		document.getElementById('spinner').style.display = 'block';
		// is PC
		if (!isPc()) {
		 document.getElementById('spinner').style.display = 'block';
		} 
	//   document.getElementById('guide').style.display = 'block';
	//   document.getElementById('overlay-img').style.display = 'none';
	  createOverlay(reader.result);
	  sleep(2000).then(() => {
		document.getElementById('spinner').style.display = 'none';
		// document.getElementById('guide').style.display = 'none';
		// document.getElementById('overlay-img').style.display = 'block';
		document.getElementById('downloadBtn').style.removeProperty('display');
	   });  

	};
	reader.readAsDataURL(event.target.files[0]);
  };

  var createOverlay = function(uploadImage) {
	var baseImg = uploadImage;
	document.getElementById('overlay-img').removeAttribute('style');
	Caman("#overlay-img", function () {
		document.getElementById('overlay-img').removeAttribute('style');
		this.brightness(5).render();
		this.newLayer(function() {
			this.setBlendingMode("normal");
			this.opacity(100);
			this.overlayImage(baseImg);
			});

			this.newLayer(function() {
			this.setBlendingMode("normal");
			this.opacity(100);
			this.overlayImage('overlay.png');
			});
		
			document.getElementById('overlay-img').removeAttribute('style');
			document.getElementById('downloadBtn').style.removeProperty('display');
			window.scrollTo(0, document.body.scrollHeight);

			// document.getElementById('overlay-img').style.display = 'none';
	});

	

	
};

  var downloadImage = function() {
	if (checkSNSBrowser()) {
		alert(`Download बटन खिचे पनि फोटो डाउन्लोड भएन भने तपाईंले फेसबुकबाट या म्यासेन्जरबाट URL खोलेराख्नुभएको हुन सक्छ।
            त्यहाँबाट डाउनलोड नहुने हुँदा Safari या Chrome बाट खोल्नुहोस्।
            Safari मा यो वेबसाइट खोल्नको लागि तलको बारमा भएको शेयर बटनमा क्लिक गरेर [Open in Safari]मा क्लिक गर्न
            सक्नुहुन्छ या URL कपी गरेर पेस्ट गरेर खोल्न पनि सक्नुहुन्छ।`);
	}
	const fileName = 'overlay-image.png';
	const uri = document.getElementById('overlay-img').toDataURL('image/png');

	// IE support check for download attribute
	if (window.navigator.msSaveOrOpenBlob) {
		let xhr = new XMLHttpRequest();
		xhr.open('GET', uri);
		xhr.responseType = 'blob';
		xhr.onloadend = () => {
			if (xhr.status !== 200) {
				return false;
			}
			window.navigator.msSaveOrOpenBlob(xhr.response, fileName);
		};
		xhr.send();
	} else {
		let link = document.createElement('a');
		link.href = uri;
		link.download = fileName;
		document.body.appendChild(link);
		link.click();
		document.body.removeChild(link);
	}
  };
  
</script>

</html>